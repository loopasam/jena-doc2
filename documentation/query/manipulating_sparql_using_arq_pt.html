<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <title>Apache Jena - Tutorial - Manipulando SPARQL usando ARQ</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/jena-doc2/css/bootstrap.css" rel="stylesheet" media="screen">
  <link href="/jena-doc2/css/bootstrap-extension.css" rel="stylesheet" type="text/css">
  
  <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
  <script src="/jena-doc2/js/jena-navigation.js" type="text/javascript"></script>
  <script src="/jena-doc2/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="/jena-doc2/js/breadcrumbs.js" type="text/javascript"></script>
</head>

<body>



<nav class="navbar navbar-default" role="navigation">
<div class="container">
  <div class="navbar-header">
 	<a class="navbar-brand" href="/jena-doc2/index.html">
		<img class="logo-menu" src="/jena-doc2/images/jena-logo/jena-logo-notext-small.png" alt="jena logo">Apache Jena</a>
  </div>
  
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>


  <div class="collapse navbar-collapse navbar-ex1-collapse">
    <ul class="nav navbar-nav">



              <li id="homepage"><a href="/jena-doc2/index.html"><span class="glyphicon glyphicon glyphicon-home"></span> Home</a></li>
              <li id="download"><a href="/jena-doc2/download/index.html"><span class="glyphicon glyphicon-download-alt"></span> Download</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-book"></span> Learn <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="dropdown-header">Tutorials</li>
                  <li><a href="/jena-doc2/tutorials/index.html">Overview</a></li>
                  <li><a href="/jena-doc2/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                  <li><a href="/jena-doc2/tutorials/sparql.html">SPARQL tutorial</a></li>
                  <li><a href="/jena-doc2/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                  <li><a href="/jena-doc2/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                  <li><a href="/jena-doc2/documentation/notes/index.html">How-To's</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">References</li>
                  <li><a href="/jena-doc2/documentation/index.html">Overview</a></li>
                  <li><a href="/jena-doc2/documentation/javadoc/">Javadoc</a></li>
                  <li><a href="/jena-doc2/documentation/rdf/index.html">RDF API</a></li>
                  <li><a href="/jena-doc2/documentation/io/">RDF I/O</a></li>
                  <li><a href="/jena-doc2/documentation/query/index.html">ARQ (SPARQL)</a></li>
                  <li><a href="/jena-doc2/documentation/query/text-query.html">Text Search</a></li>
                  <li><a href="/jena-doc2/documentation/tdb/index.html">TDB</a></li>
                  <li><a href="/jena-doc2/documentation/sdb/index.html">SDB</a></li>
                  <li><a href="/jena-doc2/documentation/serving_data/index.html">Fuseki</a></li>
                  <li><a href="/jena-doc2/documentation/assembler/index.html">Assembler</a></li>
                  <li><a href="/jena-doc2/documentation/ontology/">Ontology API</a></li>
                  <li><a href="/jena-doc2/documentation/inference/index.html">Inference API</a></li>
                  <li><a href="/jena-doc2/documentation/tools/index.html">Command-line tools</a></li>
                </ul>
              </li>
              <li id="ask"><a href="/jena-doc2/help_and_support/index.html"><span class="glyphicon glyphicon-question-sign"></span> Ask</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-bullhorn"></span> Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/jena-doc2/getting_involved/index.html">Contribute</a></li>
                  <li><a href="/jena-doc2/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Project</li>
                  <li><a href="/jena-doc2/about_jena/about.html">About Jena</a></li>
                  <li><a href="/jena-doc2/about_jena/roadmap.html">Roadmap</a></li>
                  <li><a href="/jena-doc2/about_jena/architecture.html">Architecture</a></li>
                  <li><a href="/jena-doc2/about_jena/team.html">Project team</a></li>
                  <li><a href="/jena-doc2/about_jena/contributions.html">Related projects</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">ASF</li>
                  <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                  <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>

   
    </ul>
  </div>
</div>
</nav>


<div class="container">
	<div class="row">
	<div class="col-md-12">
	<div id="breadcrumbs"></div>
	<h1 class="title">Tutorial - Manipulando SPARQL usando ARQ</h1>
  <p>Quando você começa a trabalhar com SPARQL você rapidamente descobre que queries estáticas são restritivas.
 Talvez você queira mudar um valor, adicionar um filtro, alterar o limite, etc. Sendo do tipo impaciente, 
você começa a manipular a string da query e isso funciona. Mas o que dizer de little Bobby Tables? 
Além do mais, mesmo que você limpe ao máximo suas entradas, manipulação de strings é um processo 
tenso e erros de sintaxe esperam por você. Muito embora possa parecer mais difícil do que string munging, 
a API ARQ é sua amiga na longa jornada. </p>
<p><em>Originalmente publicado em  <a href="http://researchrevealed.ilrt.bris.ac.uk/?p=35">Research Revealed project
blog</a></em></p>
<h2 id="inserindo-valores-comandos-simples-prontos">Inserindo valores (comandos simples prontos)</h2>
<p>Vamos começar com algo simples. Suponha que nós queiramos restringir a query a seguir a uma pessoa (person) em particular:</p>
<div class="codehilite"><pre>   <span class="n">select</span> <span class="o">*</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//xmlns.com/foaf/0.1/name&gt; ?name }</span>
</pre></div>


<p><code>String#replaceAll</code> deveria funcionar, mas existe um jeito mais seguro. 
<code>QueryExecutionFactory</code> em muitos casos, permite que você alimente uma  <code>QuerySolution</code>
com a qual você pode prefixar valores.</p>
<div class="codehilite"><pre>   <span class="n">QuerySolutionMap</span> <span class="n">initialBinding</span> <span class="o">=</span> <span class="n">new</span> <span class="n">QuerySolutionMap</span><span class="p">();</span>
   <span class="n">initialBinding</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">personResource</span><span class="p">);</span>
   <span class="n">qe</span> <span class="o">=</span> <span class="n">QueryExecutionFactory</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">initialBinding</span><span class="p">);</span>
</pre></div>


<p>Isto geralmente é muito mais simples do que a string equivalente desde que você não tenha usar aspas para 
citações. (Esteja ciente de que isto não funciona para 
<code>sparqlService</code>, o que é uma pena. Seria legal gastar algum tempo consertando isto.)</p>
<h2 id="fazendo-uma-query-a-partir-do-zero">Fazendo uma Query a partir do zero</h2>
<p>As limitações previamente mencionadas se devem ao fato de que prefixação na verdade não muda a query em nada, 
apenas a execução daquela query. Então, como nós realmente alteramos queries?</p>
<p>ARQ provê duas maneiras de se trabalhar com queries: no nível de sintaxe  (<code>Query</code>
and <code>Element</code>), ou no nível algébrico  (<code>Op</code>). A distinção entre eles fica claro com os filtros:</p>
<div class="codehilite"><pre>   <span class="n">SELECT</span> <span class="o">?</span><span class="n">s</span> <span class="p">{</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//example.com/val&gt; ?val . FILTER ( ?val &lt; 20 ) }</span>
</pre></div>


<p>Se você trabalha no nível de sintaxe, você irá descobrir que isso (em pseudo código) se parece com : </p>
<div class="codehilite"><pre>   <span class="p">(</span><span class="n">GROUP</span> <span class="p">(</span><span class="n">PATTERN</span> <span class="p">(</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//example.com/val&gt; ?val )) (FILTER ( &lt; ?val 20 ) ))</span>
</pre></div>


<p>Isto é, existe um grupo contendo um padrão triplo e um filtro, do mesmo jeito que você vê na query. 
A álgebra é diferente e nós podemos vê-la usando  <code>arq.qparse --print op</code></p>
<div class="codehilite"><pre>   <span class="err">$</span> <span class="n">java</span> <span class="n">arq</span><span class="p">.</span><span class="n">qparse</span> <span class="o">--</span><span class="n">print</span> <span class="n">op</span> <span class="err">&#39;</span><span class="n">SELECT</span> <span class="o">?</span><span class="n">s</span> <span class="p">{</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//example.com/val&gt; ?val . FILTER ( ?val &lt; 20 ) }&#39;</span>
   <span class="p">(</span><span class="n">base</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">:</span><span class="c1">///...&gt;</span>
       <span class="p">(</span><span class="n">project</span> <span class="p">(</span><span class="o">?</span><span class="n">s</span><span class="p">)</span>
           <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="o">&lt;</span> <span class="o">?</span><span class="n">val</span> <span class="mi">20</span><span class="p">)</span>
               <span class="p">(</span><span class="n">bgp</span> <span class="p">(</span><span class="n">triple</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//example.com/val&gt; ?val)))))</span>
</pre></div>


<p>Aqui o filtro contém o padrão, ao invés de se situar próximo a ele. Esta forma torna claro que a expressão 
está filtrando o padrão.</p>
<p>Vamos criar esta query do zero usando ARQ. Nós começamos com algumas partes comuns: a tripla a ser comparada 
e a expressão a ser filtrada.</p>
<div class="codehilite"><pre>   <span class="c1">// ?s ?p ?o .</span>
   <span class="n">Triple</span> <span class="n">pattern</span> <span class="o">=</span>
       <span class="n">Triple</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">Var</span><span class="p">.</span><span class="n">alloc</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">),</span> <span class="n">Var</span><span class="p">.</span><span class="n">alloc</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">),</span> <span class="n">Var</span><span class="p">.</span><span class="n">alloc</span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">));</span>
   <span class="c1">// ( ?s &lt; 20 )</span>
   <span class="n">Expr</span> <span class="n">e</span> <span class="o">=</span> <span class="n">new</span> <span class="n">E_LessThan</span><span class="p">(</span><span class="n">new</span> <span class="n">ExprVar</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">),</span> <span class="n">new</span> <span class="n">NodeValueInteger</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
</pre></div>


<p><code>Triple</code> deveria ser familiar de Jena.  <code>Var</code> é uma extensão de <code>Node</code>
para variáveis. <code>Expr</code> é a interface raíz para expressões, aquelas coisas que aparecem em <code>FILTER</code> and <code>LET</code>.</p>
<p>Primeiro, o caminho da sintaxe:</p>
<div class="codehilite"><pre>   <span class="n">ElementTriplesBlock</span> <span class="n">block</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ElementTriplesBlock</span><span class="p">();</span> <span class="c1">// Make a BGP</span>
   <span class="n">block</span><span class="p">.</span><span class="n">addTriple</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span>                              <span class="c1">// Add our pattern match</span>
   <span class="n">ElementFilter</span> <span class="n">filter</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ElementFilter</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>           <span class="c1">// Make a filter matching the expression</span>
   <span class="n">ElementGroup</span> <span class="n">body</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ElementGroup</span><span class="p">();</span>                <span class="c1">// Group our pattern match and filter</span>
   <span class="n">body</span><span class="p">.</span><span class="n">addElement</span><span class="p">(</span><span class="n">block</span><span class="p">);</span>
   <span class="n">body</span><span class="p">.</span><span class="n">addElement</span><span class="p">(</span><span class="n">filter</span><span class="p">);</span>

   <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">QueryFactory</span><span class="p">.</span><span class="n">make</span><span class="p">();</span>
   <span class="n">q</span><span class="p">.</span><span class="n">setQueryPattern</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>                               <span class="c1">// Set the body of the query to our group</span>
   <span class="n">q</span><span class="p">.</span><span class="n">setQuerySelectType</span><span class="p">();</span>                                <span class="c1">// Make it a select query</span>
   <span class="n">q</span><span class="p">.</span><span class="n">addResultVar</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">);</span>                                   <span class="c1">// Select ?s</span>
</pre></div>


<p>Agora a álgebra:</p>
<div class="codehilite"><pre>   <span class="n">Op</span> <span class="n">op</span><span class="p">;</span>
   <span class="n">BasicPattern</span> <span class="n">pat</span> <span class="o">=</span> <span class="n">new</span> <span class="n">BasicPattern</span><span class="p">();</span>                 <span class="c1">// Make a pattern</span>
   <span class="n">pat</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span>                                      <span class="c1">// Add our pattern match</span>
   <span class="n">op</span> <span class="o">=</span> <span class="n">new</span> <span class="n">OpBGP</span><span class="p">(</span><span class="n">pat</span><span class="p">);</span>                                   <span class="c1">// Make a BGP from this pattern</span>
   <span class="n">op</span> <span class="o">=</span> <span class="n">OpFilter</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">op</span><span class="p">);</span>                           <span class="c1">// Filter that pattern with our expression</span>
   <span class="n">op</span> <span class="o">=</span> <span class="n">new</span> <span class="n">OpProject</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Arrays</span><span class="p">.</span><span class="n">asList</span><span class="p">(</span><span class="n">Var</span><span class="p">.</span><span class="n">alloc</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">)));</span> <span class="c1">// Reduce to just ?s</span>
   <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">OpAsQuery</span><span class="p">.</span><span class="n">asQuery</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>                       <span class="c1">// Convert to a query</span>
   <span class="n">q</span><span class="p">.</span><span class="n">setQuerySelectType</span><span class="p">();</span>                                <span class="c1">// Make is a select query</span>
</pre></div>


<p>Note que o tipo da query  (<code>SELECT, CONSTRUCT, DESCRIBE, ASK</code>)não é parte da álgebra, 
e que nós temos que configurar isso na query (embora SELECT seja o padrão).  <code>FROM</code> e <code>FROM NAMED</code> 
estão igualmente ausentes.</p>
<h2 id="navegando-e-aprendendo-visitors">Navegando e Aprendendo: Visitors</h2>
<p>Você também pode olhar para a álgebra e a sintaxe usando vistors. Comece estendendo <code>OpVisitorBase</code> 
(<code>ElementVisitorBase</code>) que apaga a interface de modo que você pode se concentrar nas partes de interesse, 
então dê um passo a frente e use <code>OpWalker.walk(Op, OpVisitor)</code>
(<code>ElementWalker.walk(Element, ElementVisitor)</code>). Isso funciona no esquema “bottom up” (de baixo para cima).</p>
<p>Para algumas alterações, como manipulação de padrões triplos no local, visitors irão trabalhar bem.
 Eles provêm um jeito simples de manipular as partes certas da query e você pode alterar as BGPs backing
 padrões  tanto na álgebra quanto na sintaxe. Entretanto, mutações (mutation) não estão consistentemente
 disponíveis, não conte com elas. </p>
<h2 id="transformando-a-algebra">Transformando a Álgebra</h2>
<p>A primeira vista, não há vantagens óbvias em usar a álgebra. O real poder fica claro com o uso de 
transformers (transformações), que lhe permitem reorganizar uma álgebra completamente. ARQ faz amplo 
uso de transformers para simplificar e aperfeiçoar execuções de query.  </p>
<p>Em Research Revealed (Pesquisa revelada, em tradução livre), eu escrevi algum código para pegar certo 
número de constraints (constantes) e produzir uma query. Havia várias formas de se fazer isto, mas o 
jeito que eu achei foi gerar ops de cada constraint e juntar o resultado.  </p>
<div class="codehilite"><pre>   <span class="k">for</span> <span class="p">(</span><span class="n">Constraint</span> <span class="n">con</span><span class="o">:</span> <span class="n">cons</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">op</span> <span class="o">=</span> <span class="n">OpJoin</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">consToOp</span><span class="p">(</span><span class="n">cons</span><span class="p">));</span> <span class="c1">// join</span>
   <span class="p">}</span>
</pre></div>


<p>O resultado foi uma bagunça incrivelmente correta, que é remotamente compreensível em apenas três condições:</p>
<div class="codehilite"><pre>   <span class="p">(</span><span class="n">join</span>
       <span class="p">(</span><span class="n">join</span>
           <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="o">&lt;</span> <span class="o">?</span><span class="n">o0</span> <span class="mi">20</span><span class="p">)</span> <span class="p">(</span><span class="n">bgp</span> <span class="p">(</span><span class="n">triple</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">urn</span><span class="o">:</span><span class="n">ex</span><span class="o">:</span><span class="n">prop0</span><span class="o">&gt;</span> <span class="o">?</span><span class="n">o0</span><span class="p">)))</span>
           <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="o">&lt;</span> <span class="o">?</span><span class="n">o1</span> <span class="mi">20</span><span class="p">)</span> <span class="p">(</span><span class="n">bgp</span> <span class="p">(</span><span class="n">triple</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">urn</span><span class="o">:</span><span class="n">ex</span><span class="o">:</span><span class="n">prop1</span><span class="o">&gt;</span> <span class="o">?</span><span class="n">o1</span><span class="p">))))</span>
       <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="o">&lt;</span> <span class="o">?</span><span class="n">o2</span> <span class="mi">20</span><span class="p">)</span> <span class="p">(</span><span class="n">bgp</span> <span class="p">(</span><span class="n">triple</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">urn</span><span class="o">:</span><span class="n">ex</span><span class="o">:</span><span class="n">prop2</span><span class="o">&gt;</span> <span class="o">?</span><span class="n">o2</span><span class="p">))))</span>
</pre></div>


<p>Cada uma das constraints é um filtro e um bgp. Isso pode ser muito mais compreensível removendo os
 filtros e juntando (merging) os padrões triplos. Nós podemos fazer isso usando  <code>Transform</code>:</p>
<div class="codehilite"><pre>   <span class="n">class</span> <span class="n">QueryCleaner</span> <span class="n">extends</span> <span class="n">TransformBase</span>
   <span class="p">{</span>
       <span class="err">@</span><span class="n">Override</span>
       <span class="n">public</span> <span class="n">Op</span> <span class="n">transform</span><span class="p">(</span><span class="n">OpJoin</span> <span class="n">join</span><span class="p">,</span> <span class="n">Op</span> <span class="n">left</span><span class="p">,</span> <span class="n">Op</span> <span class="n">right</span><span class="p">)</span> <span class="p">{</span>
           <span class="c1">// Bail if not of the right form</span>
           <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">left</span> <span class="n">instanceof</span> <span class="n">OpFilter</span> <span class="o">&amp;&amp;</span> <span class="n">right</span> <span class="n">instanceof</span> <span class="n">OpFilter</span><span class="p">))</span> <span class="k">return</span> <span class="n">join</span><span class="p">;</span>
           <span class="n">OpFilter</span> <span class="n">leftF</span> <span class="o">=</span> <span class="p">(</span><span class="n">OpFilter</span><span class="p">)</span> <span class="n">left</span><span class="p">;</span>
           <span class="n">OpFilter</span> <span class="n">rightF</span> <span class="o">=</span> <span class="p">(</span><span class="n">OpFilter</span><span class="p">)</span> <span class="n">right</span><span class="p">;</span>

           <span class="c1">// Add all of the triple matches to the LHS BGP</span>
           <span class="p">((</span><span class="n">OpBGP</span><span class="p">)</span> <span class="n">leftF</span><span class="p">.</span><span class="n">getSubOp</span><span class="p">()).</span><span class="n">getPattern</span><span class="p">().</span><span class="n">addAll</span><span class="p">(((</span><span class="n">OpBGP</span><span class="p">)</span> <span class="n">rightF</span><span class="p">.</span><span class="n">getSubOp</span><span class="p">()).</span><span class="n">getPattern</span><span class="p">());</span>
           <span class="c1">// Add the RHS filter to the LHS</span>
           <span class="n">leftF</span><span class="p">.</span><span class="n">getExprs</span><span class="p">().</span><span class="n">addAll</span><span class="p">(</span><span class="n">rightF</span><span class="p">.</span><span class="n">getExprs</span><span class="p">());</span>
           <span class="k">return</span> <span class="n">leftF</span><span class="p">;</span>
       <span class="p">}</span>
   <span class="p">}</span>
   <span class="p">...</span>
   <span class="n">op</span> <span class="o">=</span> <span class="n">Transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">new</span> <span class="n">QueryCleaner</span><span class="p">(),</span> <span class="n">op</span><span class="p">);</span> <span class="c1">// clean query</span>
</pre></div>


<p>O código abaixo procura pelos  joins do formulário:</p>
<div class="codehilite"><pre>   <span class="p">(</span><span class="n">join</span>
       <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="n">exp1</span><span class="p">)</span> <span class="p">(</span><span class="n">bgp1</span><span class="p">))</span>
       <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="n">exp2</span><span class="p">)</span> <span class="p">(</span><span class="n">bgp2</span><span class="p">)))</span>
</pre></div>


<p>E substitui ele com:</p>
<div class="codehilite"><pre>   <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="n">exp1</span> <span class="o">&amp;&amp;</span> <span class="n">exp2</span><span class="p">)</span> <span class="p">(</span><span class="n">bgp1</span> <span class="o">&amp;&amp;</span> <span class="n">bgp2</span><span class="p">))</span>
</pre></div>


<p>Enquanto nós percorremos a query original, todos os joins são removidos e o resultado final é:</p>
<div class="codehilite"><pre>   <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="n">exprlist</span> <span class="p">(</span><span class="o">&lt;</span> <span class="o">?</span><span class="n">o0</span> <span class="mi">20</span><span class="p">)</span> <span class="p">(</span><span class="o">&lt;</span> <span class="o">?</span><span class="n">o1</span> <span class="mi">20</span><span class="p">)</span> <span class="p">(</span><span class="o">&lt;</span> <span class="o">?</span><span class="n">o2</span> <span class="mi">20</span><span class="p">))</span>
       <span class="p">(</span><span class="n">bgp</span>
           <span class="p">(</span><span class="n">triple</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">urn</span><span class="o">:</span><span class="n">ex</span><span class="o">:</span><span class="n">prop0</span><span class="o">&gt;</span> <span class="o">?</span><span class="n">o0</span><span class="p">)</span>
           <span class="p">(</span><span class="n">triple</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">urn</span><span class="o">:</span><span class="n">ex</span><span class="o">:</span><span class="n">prop1</span><span class="o">&gt;</span> <span class="o">?</span><span class="n">o1</span><span class="p">)</span>
           <span class="p">(</span><span class="n">triple</span> <span class="o">?</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">urn</span><span class="o">:</span><span class="n">ex</span><span class="o">:</span><span class="n">prop2</span><span class="o">&gt;</span> <span class="o">?</span><span class="n">o2</span><span class="p">)</span>
   <span class="p">))</span>
</pre></div>


<p>Isto completa esta breve introdução. Existe muito mais em ARQ, claro, mas esperamos que você tenha tido um gostinho do que ele pode fazer.</p>
  </div>
</div>

</div><!--/.container -->

    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        </p>
        <p>
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
        </p>
      </div>
  </footer>
      

</body>
</html>
