<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <title>Apache Jena - Extensions in ARQ</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/jena-doc2/css/bootstrap.css" rel="stylesheet" media="screen">
  <link href="/jena-doc2/css/bootstrap-extension.css" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/jena-doc2/images/favicon.ico" />
  
  <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
  <script src="/jena-doc2/js/jena-navigation.js" type="text/javascript"></script>
  <script src="/jena-doc2/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="/jena-doc2/js/breadcrumbs.js" type="text/javascript"></script>
  
  <link href="/jena-doc2/css/borland.css" rel="stylesheet" type="text/css">



</head>

<body>



<nav class="navbar navbar-default" role="navigation">
<div class="container">
  <div class="navbar-header">
  
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
 	<a class="navbar-brand" href="/jena-doc2/index.html">
		<img class="logo-menu" src="/jena-doc2/images/jena-logo/jena-logo-notext-small.png" alt="jena logo">Apache Jena</a>
  </div>
 


  <div class="collapse navbar-collapse navbar-ex1-collapse">
    <ul class="nav navbar-nav">



              <li id="homepage"><a href="/jena-doc2/index.html"><span class="glyphicon glyphicon-home"></span> Home</a></li>
              <li id="download"><a href="/jena-doc2/download/index.html"><span class="glyphicon glyphicon-download-alt"></span> Download</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-book"></span> Learn <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="dropdown-header">Tutorials</li>
                  <li><a href="/jena-doc2/tutorials/index.html">Overview</a></li>
                  <li><a href="/jena-doc2/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                  <li><a href="/jena-doc2/tutorials/sparql.html">SPARQL tutorial</a></li>
                  <li><a href="/jena-doc2/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                  <li><a href="/jena-doc2/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                  <li><a href="/jena-doc2/documentation/notes/index.html">How-To's</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">References</li>
                  <li><a href="/jena-doc2/documentation/index.html">Overview</a></li>
                  <li><a href="/jena-doc2/documentation/javadoc/">Javadoc</a></li>
                  <li><a href="/jena-doc2/documentation/rdf/index.html">RDF API</a></li>
                  <li><a href="/jena-doc2/documentation/io/">RDF I/O</a></li>
                  <li><a href="/jena-doc2/documentation/query/index.html">ARQ (SPARQL)</a></li>
                  <li><a href="/jena-doc2/documentation/query/text-query.html">Text Search</a></li>
                  <li><a href="/jena-doc2/documentation/tdb/index.html">TDB</a></li>
                  <li><a href="/jena-doc2/documentation/sdb/index.html">SDB</a></li>
                  <li><a href="/jena-doc2/documentation/serving_data/index.html">Fuseki</a></li>
                  <li><a href="/jena-doc2/documentation/assembler/index.html">Assembler</a></li>
                  <li><a href="/jena-doc2/documentation/ontology/">Ontology API</a></li>
                  <li><a href="/jena-doc2/documentation/inference/index.html">Inference API</a></li>
                  <li><a href="/jena-doc2/documentation/tools/index.html">Command-line tools</a></li>
                </ul>
              </li>
              <li id="ask"><a href="/jena-doc2/help_and_support/index.html"><span class="glyphicon glyphicon-question-sign"></span> Ask</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-bullhorn"></span> Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/jena-doc2/getting_involved/index.html">Contribute</a></li>
                  <li><a href="/jena-doc2/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Project</li>
                  <li><a href="/jena-doc2/about_jena/about.html">About Jena</a></li>
                  <li><a href="/jena-doc2/about_jena/roadmap.html">Roadmap</a></li>
                  <li><a href="/jena-doc2/about_jena/architecture.html">Architecture</a></li>
                  <li><a href="/jena-doc2/about_jena/team.html">Project team</a></li>
                  <li><a href="/jena-doc2/about_jena/contributions.html">Related projects</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">ASF</li>
                  <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                  <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>

   
    </ul>
  </div>
</div>
</nav>


<div class="container">
	<div class="row">
	<div class="col-md-12">
	<div id="breadcrumbs"></div>
	<h1 class="title">Extensions in ARQ</h1>
  <p>There are several ways to extend the ARQ query engine within the
SPARQL syntax. ARQ also has syntactic extensions for GROUP BY,
nested SELECTs and assignment; these are described elsewhere.</p>
<ul>
<li><a href="#value-functions">Filter Functions</a> - additional operations in
    FILTERS</li>
<li><a href="#property-functions">Property functions</a> - adding predicates
    that introduce custom query stages</li>
<li><a href="#describe-handlers">DESCRIBE handlers</a></li>
<li>Support for
    <a href="#match-blank-node-labels">finding blank nodes by label</a></li>
<li><a href="arq-query-eval.html">Extending query evaluation</a> for querying
    different storage and inference systems</li>
</ul>
<p>Functions are standard part of SPARQL. ARQ provides
application-written functions and provides a
<a href="library-function.html">function library</a>. Applications can
<a href="writing_functions.html">write and register their own functions</a>.</p>
<p>Property functions provide a way to provide custom matching of
particular predicates. They enable triple matches to be calculated,
rather than just looked up in a RDF graph and they are a way to add
functionality and remain within SPARQL. ARQ has a
<a href="library-propfunc.html">property function library</a>. Applications
can
<a href="writing_propfunc.html">write and register their own property functions</a>.</p>
<p>The <a href="/jena-doc2/documentation/larq/">free text support in ARQ</a> is provided by
<a href="http://lucene.apache.org/java/docs/index.html">Lucene</a>, using
property functions.</p>
<h2 id="filter-functions">Filter Functions</h2>
<p>A SPARQL custom function is implementation dependent. Most details
of the ARQ query engine do not have to be understood to write a
function; it is a matter of implementing one interface.  This is
made simpler for many cases by a number of base classes that
provide much of the machinery needed.</p>
<h3 id="function-registry">Function Registry</h3>
<p>Functions can be installed into the function registry by the
application. The function registry is a mapping from URI to a
factory class for functions (each time a function is mentioned in a
query, a new instance is created) and there is an auto-factory
class so just registering a Java class will work. A function can
access the queried dataset.</p>
<h3 id="dynamically-loaded-functions">Dynamically Loaded Functions</h3>
<p>The ARQ function library uses this mechanism.  The namespace of the
ARQ function library is &lt;<code>http://jena.hpl.hp.com/ARQ/function#&gt;</code>.</p>
<div class="codehilite"><pre><span class="nx">PREFIX</span> <span class="nx">afn</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">http</span><span class="o">:</span><span class="c1">//jena.hpl.hp.com/ARQ/function#&gt;PREFIX dc: &lt;http://purl.org/dc/elements/1.1/&gt;SELECT ?v{ ?x dc:date ?date . FILTER (?date &lt; afn:now() )}</span>
</pre></div>


<p>The afn:now returns the time the query started.</p>
<p>The filter functions in the ARQ distribution are described on the
<a href="library-function.html">filter function library page</a>.</p>
<p>URIs for functions in the (fake)
<a href="java-uri.html">URI scheme <code>java:</code></a> are dynamically loaded. The
class name forms the scheme specific part of the URI.</p>
<h2 id="property-functions">Property functions</h2>
<p>Property functions, sometimes called "magic properties", are
properties that cause triple matching to happen by executing some
piece of code, determined by the property URI, and not by the usual
graph matching. They can be used to give certain kinds of inference
and rule processing. Some calculated properties have additional,
non-declarative requirements such as needing one of other of the
subject or object to be a query constant or a bound value, and not
able to generate all possibilities for that slot.</p>
<p>Property functions must have fixed URI for the predicate (it can't
be query variable). They may take a list for subject or object.</p>
<p>One common case is for access to collections (RDF lists) or
containers (rdf:Bag, rdf:Seq, rdf:Alt).</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">list</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//jena.hpl.hp.com/ARQ/list#&gt;SELECT ?member{ ?x :p ?list .     # Some way to find the list ?list list:member ?member .}</span>
</pre></div>


<p>which can also be written:</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">list</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//jena.hpl.hp.com/ARQ/list#&gt;SELECT ?member{ ?x :p [ list:member ?member ] }</span>
</pre></div>


<p>Likewise, RDF containers:</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">rdfs</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2000/01/rdf-schema#&gt;SELECT ?member{ ?x :p ?bag .     # Some way to find the bag ?bag rdfs:member ?member .}</span>
</pre></div>


<p>Property functions can also take lists in the subject or object
slot.</p>
<p>Code for properties can be dynamically loaded or pre-registered.
For example, <code>splitIRI</code> will take an IRI and assign the namespace
ad localname parts to variables (if the variables are already
bound, not constants are used, <code>splitIRI</code> will check the values).</p>
<div class="codehilite"><pre><span class="nx">PREFIX</span> <span class="nx">xsd</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/XMLSchema#&gt;</span>
<span class="nx">PREFIX</span> <span class="nx">apf</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">java</span><span class="o">:</span><span class="nx">com</span><span class="p">.</span><span class="nx">hp</span><span class="p">.</span><span class="nx">hpl</span><span class="p">.</span><span class="nx">jena</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">pfunction</span><span class="p">.</span><span class="nx">library</span><span class="p">.</span><span class="o">&gt;</span><span class="nx">SELECT</span> <span class="o">?</span><span class="nx">namespace</span> <span class="o">?</span><span class="nx">localname</span><span class="p">{</span> <span class="nx">xsd</span><span class="o">:</span><span class="nx">string</span> <span class="nx">apf</span><span class="o">:</span><span class="nx">splitIRI</span> <span class="p">(</span><span class="o">?</span><span class="nx">namespace</span> <span class="o">?</span><span class="nx">localname</span><span class="p">)</span> <span class="p">}</span>
</pre></div>


<p>Property functions might conflict with inference rules and it can
be turned off by the Java code:</p>
<div class="codehilite"><pre> <span class="n">ARQ</span><span class="p">.</span><span class="n">setFalse</span><span class="p">(</span><span class="n">ARQ</span><span class="p">.</span><span class="n">enablePropertyFunctions</span><span class="p">)</span> <span class="p">;</span>
</pre></div>


<p>or on a per instance basis:</p>
<div class="codehilite"><pre> <span class="n">QueryExecution</span> <span class="n">qExec</span> <span class="o">=</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="p">;</span> <span class="n">qExec</span><span class="p">.</span><span class="n">getContext</span><span class="p">().</span><span class="n">setFalse</span><span class="p">(</span><span class="n">ARQ</span><span class="p">.</span><span class="n">enablePropertyFunctions</span><span class="p">)</span> <span class="p">;</span>
</pre></div>


<p>The property functions in the ARQ distribution are described on the
<a href="library-propfunc.html">property function library page</a>.</p>
<p>URIs for functions in the (fake)
<a href="java-uri.html">URI scheme <code>java:</code></a> are dynamically loaded. The
class name forms the scheme specific part of the URI.</p>
<h2 id="describe-handlers">DESCRIBE handlers</h2>
<p>The <code>DESCRIBE</code> result form in SPARQL does not define an exact form
of RDF to return. Instead, it allows the server or query processor
to return what it considers to be an appropriate description of the
resources located. This description will be specific to the domain,
data modelling or application.</p>
<p>ARQ comes with one built-in handler which calculates the blank node
closure of resources found. While suitable for many situations, it
is not general (for example, a <a href="http://www.foaf-project.org/">FOAF</a>
file usually consists of all blank nodes). ARQ allows the
application to replace or add handlers for producing <code>DESCRIBE</code>
result forms.</p>
<p>Application-specific handlers can be added to the
<code>DescribeHandlerRegistry</code>. The handler will be called for each
resource (not literals) identified by the <code>DESCRIBE</code> query.</p>
<h2 id="blank-node-labels">Blank Node Labels</h2>
<p>URIs from with scheme name "_" (which is illegal) are created as
blank node labels for directly accessing a blank node in the
queried graph or dataset. This are constant terms in the query -
not unnamed variables. Do not confuse these with the standard
qname-like notation for blank nodes in queries. This is not
portable - use with care.</p>
<div class="codehilite"><pre><span class="o">&lt;</span><span class="n">_</span><span class="o">:</span><span class="mi">1234</span><span class="o">-</span><span class="mi">5678</span><span class="o">-</span><span class="mi">90</span><span class="o">&gt;</span> <span class="err">#</span> <span class="n">A</span> <span class="n">blank</span> <span class="n">node</span> <span class="n">in</span> <span class="n">the</span> <span class="n">data</span>

<span class="nl">_:</span><span class="n">b0</span> <span class="err">#</span> <span class="n">A</span> <span class="n">blank</span> <span class="n">node</span> <span class="n">in</span> <span class="n">the</span> <span class="n">query</span> <span class="o">-</span> <span class="n">a</span> <span class="n">variable</span>
</pre></div>
  </div>
</div>

</div><!--/.container -->

    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        </p>
        <p>
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
        </p>
      </div>
  </footer>
      

</body>
</html>
