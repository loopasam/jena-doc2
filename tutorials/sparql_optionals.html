<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <title>Apache Jena - SPARQL Tutorial - Optional Information</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/jena-doc2/css/bootstrap.css" rel="stylesheet" media="screen">
  <link href="/jena-doc2/css/bootstrap-extension.css" rel="stylesheet" type="text/css">
  
  <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
  <script src="/jena-doc2/js/jena-navigation.js" type="text/javascript"></script>
  <script src="/jena-doc2/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="/jena-doc2/js/breadcrumbs.js" type="text/javascript"></script>
</head>

<body>



<nav class="navbar navbar-default" role="navigation">
<div class="container">
  <div class="navbar-header">
 	<a class="navbar-brand" href="/jena-doc2/index.html">
		<img class="logo-menu" src="/jena-doc2/images/jena-logo/jena-logo-notext-small.png" alt="jena logo">Apache Jena</a>
  </div>
  
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>


  <div class="collapse navbar-collapse navbar-ex1-collapse">
    <ul class="nav navbar-nav">



              <li id="homepage"><a href="/jena-doc2/index.html"><span class="glyphicon glyphicon-home"></span> Home</a></li>
              <li id="download"><a href="/jena-doc2/download/index.html"><span class="glyphicon glyphicon-download-alt"></span> Download</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-book"></span> Learn <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li class="dropdown-header">Tutorials</li>
                  <li><a href="/jena-doc2/tutorials/index.html">Overview</a></li>
                  <li><a href="/jena-doc2/tutorials/rdf_api.html">RDF core API tutorial</a></li>
                  <li><a href="/jena-doc2/tutorials/sparql.html">SPARQL tutorial</a></li>
                  <li><a href="/jena-doc2/documentation/query/manipulating_sparql_using_arq.html">Manipulating SPARQL using ARQ</a></li>
                  <li><a href="/jena-doc2/tutorials/using_jena_with_eclipse.html">Using Jena with Eclipse</a></li>
                  <li><a href="/jena-doc2/documentation/notes/index.html">How-To's</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">References</li>
                  <li><a href="/jena-doc2/documentation/index.html">Overview</a></li>
                  <li><a href="/jena-doc2/documentation/javadoc/">Javadoc</a></li>
                  <li><a href="/jena-doc2/documentation/rdf/index.html">RDF API</a></li>
                  <li><a href="/jena-doc2/documentation/io/">RDF I/O</a></li>
                  <li><a href="/jena-doc2/documentation/query/index.html">ARQ (SPARQL)</a></li>
                  <li><a href="/jena-doc2/documentation/query/text-query.html">Text Search</a></li>
                  <li><a href="/jena-doc2/documentation/tdb/index.html">TDB</a></li>
                  <li><a href="/jena-doc2/documentation/sdb/index.html">SDB</a></li>
                  <li><a href="/jena-doc2/documentation/serving_data/index.html">Fuseki</a></li>
                  <li><a href="/jena-doc2/documentation/assembler/index.html">Assembler</a></li>
                  <li><a href="/jena-doc2/documentation/ontology/">Ontology API</a></li>
                  <li><a href="/jena-doc2/documentation/inference/index.html">Inference API</a></li>
                  <li><a href="/jena-doc2/documentation/tools/index.html">Command-line tools</a></li>
                </ul>
              </li>
              <li id="ask"><a href="/jena-doc2/help_and_support/index.html"><span class="glyphicon glyphicon-question-sign"></span> Ask</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-bullhorn"></span> Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/jena-doc2/getting_involved/index.html">Contribute</a></li>
                  <li><a href="/jena-doc2/help_and_support/bugs_and_suggestions.html">Report a bug</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Project</li>
                  <li><a href="/jena-doc2/about_jena/about.html">About Jena</a></li>
                  <li><a href="/jena-doc2/about_jena/roadmap.html">Roadmap</a></li>
                  <li><a href="/jena-doc2/about_jena/architecture.html">Architecture</a></li>
                  <li><a href="/jena-doc2/about_jena/team.html">Project team</a></li>
                  <li><a href="/jena-doc2/about_jena/contributions.html">Related projects</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">ASF</li>
                  <li><a href="http://www.apache.org/">Apache Software Foundation</a></li>
                  <li><a href="http://www.apache.org/licenses/LICENSE-2.0">License</a></li>
                  <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                  <li><a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li>
                  <li><a href="http://www.apache.org/security/">Security</a></li>
                </ul>
              </li>

   
    </ul>
  </div>
</div>
</nav>


<div class="container">
	<div class="row">
	<div class="col-md-12">
	<div id="breadcrumbs"></div>
	<h1 class="title">SPARQL Tutorial - Optional Information</h1>
  <p>RDF is semi-structured data so SPARQL has a the ability to query
for data but not to fail query when that data does not exist. The
query is using an optional part to extend the information found in
a query solution but to return the non-optional information
anyway.</p>
<h2 id="optionals">OPTIONALs</h2>
<p>This query (<a href="sparql_data/q-opt1.rq">q-opt1.rq</a>) gets the name of a person and
also their age if that piece of information is available.</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>    <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>   <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Two of the four people in the data (<a href="sparql_data/vc-db-2.rdf">vc-db-2.rdf</a>)have
age properties so two of the query solutions have that
information.Â  However, because the triple pattern for the age is
optional, there is a pattern solution for the people who don't have
age information.</p>
<div class="codehilite"><pre><span class="o">------------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span> <span class="mi">23</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>If the optional clause had not been there, no age information would
have been retrieved. If the triple pattern had been included but
not optional then we would have the query
(<a href="sparql_data/q-opt2.rq">q-opt2.rq</a>):</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>   <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>  <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>


<p>with only two solutions:</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span> <span class="mi">23</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>because the <code>info:age</code> property must now be present in a solution.</p>
<h2 id="optionals-with-filters">OPTIONALs with FILTERs</h2>
<p><code>OPTIONAL</code> is a binary operator that combines two graph patterns.
The optional pattern is any group pattern and may involve any
SPARQL pattern types.Â  If the group matches, the solution is
extended, if not, the original solution is given
(<a href="sparql_data/q-opt3.rq">q-opt-3.rq</a>).</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>        <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>      <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span> <span class="n">FILTER</span> <span class="p">(</span> <span class="o">?</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">24</span> <span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>So, if we filter for ages greater than 24 in the optional part, we
will still get 4 solutions (from the <code>vcard:FN</code> pattern) but only
get ages if they pass the test.</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Becky Smith&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>No age included for "Becky Smith" because it is less than 24.</p>
<p>If the filter condition is moved out of the optional part, then it
can influence the number of solutions but it may be necessary to
make the filter more complicated to allow for variable <code>age</code> being
unbound (<a href="sparql_data/q-opt4.rq">q-opt4.rq</a>).</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">info</span><span class="o">:</span>        <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//somewhere/peopleInfo#&gt;</span>
<span class="n">PREFIX</span> <span class="n">vcard</span><span class="o">:</span>      <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span> <span class="o">?</span><span class="n">age</span>
<span class="n">WHERE</span>
<span class="p">{</span>
    <span class="o">?</span><span class="n">person</span> <span class="n">vcard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">.</span>
    <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">person</span> <span class="n">info</span><span class="o">:</span><span class="n">age</span> <span class="o">?</span><span class="n">age</span> <span class="p">.</span> <span class="p">}</span>
    <span class="n">FILTER</span> <span class="p">(</span> <span class="o">!</span><span class="n">bound</span><span class="p">(</span><span class="o">?</span><span class="n">age</span><span class="p">)</span> <span class="o">||</span> <span class="o">?</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">24</span> <span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>If a solution has an <code>age</code> variable, then it must be greater than
24. It can also be unbound.Â  There are now three solutions:</p>
<div class="codehilite"><pre><span class="o">-----------------------</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">age</span> <span class="o">|</span>
<span class="o">=======================</span>
<span class="o">|</span> <span class="s">&quot;Sarah Jones&quot;</span> <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;John Smith&quot;</span>  <span class="o">|</span> <span class="mi">25</span>  <span class="o">|</span>
<span class="o">|</span> <span class="s">&quot;Matt Jones&quot;</span>  <span class="o">|</span>     <span class="o">|</span>
<span class="o">-----------------------</span>
</pre></div>


<p>Evaluating an expression which has an unbound variables where a
bound one was expected causes an evaluation exception and the whole
expression fails.</p>
<h2 id="optionals-and-order-dependent-queries">OPTIONALs and Order Dependent Queries</h2>
<p>One thing to be careful of is using the same variable in two or
more optional clauses (and not in some basic pattern as well):</p>
<div class="codehilite"><pre><span class="n">PREFIX</span> <span class="n">foaf</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//xmlns.com/foaf/0.1/&gt;</span>
<span class="n">PREFIX</span> <span class="n">vCard</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.w3.org/2001/vcard-rdf/3.0#&gt;</span>

<span class="n">SELECT</span> <span class="o">?</span><span class="n">name</span>
<span class="n">WHERE</span>
<span class="p">{</span>
  <span class="o">?</span><span class="n">x</span> <span class="n">a</span> <span class="n">foaf</span><span class="o">:</span><span class="n">Person</span> <span class="p">.</span>
  <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">x</span> <span class="n">foaf</span><span class="o">:</span><span class="n">name</span> <span class="o">?</span><span class="n">name</span> <span class="p">}</span>
  <span class="n">OPTIONAL</span> <span class="p">{</span> <span class="o">?</span><span class="n">x</span> <span class="n">vCard</span><span class="o">:</span><span class="n">FN</span>  <span class="o">?</span><span class="n">name</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>If the first optional binds <code>?name</code> and <code>?x</code> to some values, the
second <code>OPTIONAL</code> is an attempt to match the ground triples (<code>?x</code>
and <code>&lt;kbd&gt;?name&lt;/kbd&gt;</code> have values). If the first optional did not
match the optional part, then the second one is an attempt to match
it's triple with two variables.</p>
<p><a href="sparql_union.html">Next: union queries</a></p>
  </div>
</div>

</div><!--/.container -->

    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2011&ndash;2013 The Apache Software Foundation, Licensed under
        the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
        </p>
        <p>
        Apache Jena, Jena, the Apache Jena project logo,
        Apache and the Apache feather logos are trademarks of The Apache Software Foundation.
        </p>
      </div>
  </footer>
      

</body>
</html>
